<!DOCTYPE html>
<html lang="pl">
<head>
    {#    <meta name="google-signin-scope" content="profile email">#}
    <meta name="google-signin-client_id"
          content="557305630089-3sr6loe91a193q6t9e2du5np98rt0khf.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Aladin|Almendra+Display|Black+Ops+One|Cabin+Sketch:400,700|Caesar+Dressing|Creepster|East+Sea+Dokdo|Faster+One|Finger+Paint|Fredericka+the+Great|Gugi|IM+Fell+English+SC|Indie+Flower|Josefin+Slab:400,700|Kirang+Haerang|Libre+Barcode+39|Libre+Barcode+39+Extended+Text|Londrina+Sketch|Love+Ya+Like+A+Sister|Megrim|Merienda:400,700|Permanent+Marker|Press+Start+2P|Quantico:400,700|Rock+Salt|Shadows+Into+Light|Special+Elite|Trade+Winds|VT323|Yatra+One&amp;subset=latin-ext"
          rel="stylesheet">
    <link rel=stylesheet type=text/css href="/static/style/first-page-style.css">
    <title>{{ info[0] }}</title>
</head>
<body onload="loginButton()">
<div id="alx-gbtn">
    <div class="alx-gbtn">
        <h2>Zaloguj sie przez Google!</h2>
        <div class="g-signin2" align="center" data-width="300" data-height="50" data-onsuccess="onSignIn"
             data-theme="dark"></div>
        <div>
            <button class="alx-btn" onclick="loginTest()">Login Test</button>
            <button class="alx-btn" onclick="closeLoginForm()">Zamknij</button>
        </div>
    </div>
</div>
<div id="userinfo">
    <img id="userimg" src="">
    <span id="username"></span>
</div>
<div class="alx-cont">
    <div class="alx-flex">
        <div class="alx-flex-box">
            <h1>Trashpanda</h1>
        </div>
        <div class="alx-flex-box">
            <img src="/static/pic/logo.png">
        </div>
        <div class="alx-flex-box">
            <form>
                <input type="text" class="search-in" placeholder="Wpisz czego szukas...">
                <button type="submit" class="search-btn">Szukaj</button>
            </form>
        </div>
        <div class="alx-flex-box" id="func-btn">
            <button class="alx-btn" onclick="openLoginForm()"><span id="isSignIn"></span></button>
            <button class="alx-btn" onclick="goTo('info')">Info</button>
        </div>
    </div>
</div>
<div class="alx-freeSpace"></div>
<div class="alx-foo">
    <div class="alx-foo-item"><a href="kontakt">Kontakt</a></div>
    <div class="alx-foo-item">LLAPADAY</div>
    <div class="alx-foo-item"><a href="about">O nas</a></div>
</div>

<script>

    function goTo(where) {
        window.location.replace(where);
    }

    {#-------------------------------------------------
    isSignIn odpowiada za to, czy przycisk logowania
    przekieruje do logowania google (jeśli false),
    czy na chmurę (jeśli true)
    -------------------------------------------------#}
    var isSignIn = false;
    var userID = 1234567890;
    var userPic = "https://lh5.googleusercontent.com/-p-7kqdTngmk/AAAAAAAAAAI/AAAAAAAAAkA/LS9olK6iiME/s96-c/photo.jpg";
    var userName = "Aleks";

    {#-------------------------------------------------
    Ciało funkcji wykonuje się po zalogowaniu na konto
    google
    -------------------------------------------------#}

    function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log('Full Name: ' + profile.getName());
        console.log('Given Name: ' + profile.getGivenName());
        console.log('Family Name: ' + profile.getFamilyName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail());

        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);

        // Wywołanie zmian po zalogowaniu
        userID = profile.getId();
        userPic = profile.getImageUrl();
        userName = profile.getGivenName();
        isSignIn = true;
        closeLoginForm();
        afterlogin();
        loginButton();
    };

    function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
            console.log('User signed out.');
        });
    }

    function afterlogin() {
        document.getElementById("userinfo").style.display = "initial";
        document.getElementById("userimg").src = userPic;
        document.getElementById("username").innerHTML = userName;
    }

    function loginTest() {
        afterlogin();
        isSignIn = true;
        loginButton();
        closeLoginForm();
    }

    {#-------------------------------------------------
    Edycja przycisku logowania i wylogowania
    -------------------------------------------------#}

    function loginButton() {
        if (isSignIn) {
            document.getElementById("isSignIn").innerText = "My Trashbox";
            let btn = document.createElement("BUTTON");
            btn.className = "alx-btn";
            btn.innerText = "Wyloguj";
            btn.addEventListener("click", logout);
            document.getElementById("func-btn").appendChild(btn);
        } else {
            document.getElementById("isSignIn").innerText = "Zaloguj się";
        }
    }

    function logout() {
        signOut();
        isSignIn = false;
        location.reload();
    }

    var glogin = document.getElementById("alx-gbtn");

    function openLoginForm() {
        if (isSignIn) {
            alert("My Trashbox will be able soon!");
        } else {
            glogin.style.transition = "all 200ms";
            glogin.style.opacity = "1";
            glogin.style.zIndex = "10";
        }
    }

    function closeLoginForm() {
        glogin.style.opacity = "0";
        glogin.style.zIndex = "-10";
    }

</script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</body>
</html>